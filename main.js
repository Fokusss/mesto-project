(()=>{"use strict";var e={url:"https://mesto.nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"69e1601f-6c3f-4190-af86-3fd180da8137","Content-Type":"application/json"}},t=document.querySelector(".profile__avatar"),n=document.querySelector(".pop-up_el_profile-edit"),r=document.querySelector(".profile__edit"),o=document.querySelector('form[name="profile-edit"]'),c=n.querySelector(".pop-up__close"),u=n.querySelector(".form__save"),i=document.querySelector(".pop-up_el_add-card"),a=document.querySelector(".profile__add"),l=i.querySelector('form[name="card-add"]'),s=i.querySelector(".pop-up__close"),d=document.querySelector("#card-js").content,f=document.querySelector(".photo__grid"),_=document.querySelector(".pop-up_el_image"),m=_.querySelector(".pop-up__close"),p=_.querySelector(".pop-up__images"),v=n.querySelector('input[name="name"]'),y=n.querySelector('input[name="text"]'),h=document.querySelector(".profile__name"),S=document.querySelector(".profile__text"),q=i.querySelector('input[name="mesto-name"]'),E=i.querySelector('input[name="url-image"]'),L=document.querySelector(".pop-up_el_delete"),k=L.querySelector(".pop-up__close"),g=L.querySelector(".form__save"),C=document.querySelector(".profile__avatar-button"),b=document.querySelector(".pop-up_el_avatar-edit"),A=b.querySelector(".pop-up__close"),x=b.querySelector(".pop-up__form"),T=x.querySelector('input[name="avatar-lik"]'),j=document.querySelector(".photo__grid"),P={formSelector:".pop-up__form",inputSelector:".form__input",submitButtonSelector:".form__save",inactiveButtonClass:"form__save_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_active"},B=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent="",t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass)},D=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))};function w(e){var t=Array.from(e.querySelectorAll(P.inputSelector)),n=e.querySelector(P.submitButtonSelector);t.forEach((function(t){return B(e,t,P)})),D(t,n,P)}function N(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var O,J=function(t,n){return fetch("".concat(e.url,"/cards/likes/").concat(t.id),{method:n,headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))};function G(e,t,n){if(t.parentElement.querySelector(".card__linke-count").textContent=n.length,0!==n.length){var r=n.find((function(t){return t._id===e.id}));console.log(r),null!=r?t.classList.add("card__like_active"):t.classList.remove("card__like_active")}}function H(t){var n=d.querySelector("li").cloneNode(!0),r=n.querySelector(".card__delete"),o=n.querySelector(".card__like"),c=n.querySelector(".card__image"),u=n.querySelector(".card__linke-count");return n.querySelector(".card__name").textContent=t.name,c.src=t.link,c.alt=t.name,r.setAttribute("id",t._id),o.setAttribute("id",t._id),u.textContent=t.likes.length,function(e,t,n){t._id!=e.id&&n.classList.add("card__delete_inactive")}(e,t.owner,r),G(e,o,t.likes),r.addEventListener("click",(function(e){return function(e){var t=e.target;Q(L),function(e){g.setAttribute("id",e.id)}(t)}(e)})),o.addEventListener("click",(function(t){return function(t){var n=t.target;n.classList.contains("card__like_active")?J(n,"DELETE").then((function(t){G(e,n,t.likes)})).catch((function(e){return console.log(e)})):J(n,"PUT").then((function(t){G(e,n,t.likes)})).catch((function(e){return console.log(e)}))}(t)})),c.addEventListener("click",(function(e){return n=t.name,r=t.link,p.src=r,p.alt=n,_.querySelector(".pop-up__caption").textContent=n,void Q(_);var n,r})),n}function z(e){var t=H(e);f.prepend(t)}function M(e){h.textContent=e.name,S.textContent=e.about}function U(e){t.setAttribute("src",e.avatar)}function F(e){"Escape"===e.key&&R(document.querySelector(".pop-up_active"))}function I(e,t,n){e.textContent=n}function K(e){e.target.classList.contains("pop-up")&&R(e.target)}function Q(e){e.classList.add("pop-up_active"),document.addEventListener("keydown",F),document.addEventListener("mousedown",K)}function R(e){e.classList.remove("pop-up_active"),document.removeEventListener("keydown",F),document.removeEventListener("mousedown",K)}O=P,Array.from(document.querySelectorAll(O.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?B(e,t,n):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=t.validationMessage,t.classList.add(n.inputErrorClass),r.classList.add(n.errorClass)}(e,t,n)}(e,o,t),D(n,r,t)}))}))}(e,O)})),Promise.all([fetch("".concat(e.url,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return N(e)})),fetch("".concat(e.url,"/users/me"),{headers:e.headers,method:"GET"}).then((function(e){return N(e)}))]).then((function(t){var n,r=t[0],o=t[1];M(o),U(o),n=o,e.id=n._id,r.reverse(),r.forEach((function(e){z(e)}))})).catch((function(e){return console.log(e)})),r.addEventListener("click",(function(){return v.value=h.textContent,y.value=S.textContent,Q(n),void w(n)})),o.addEventListener("submit",(function(t){return function(t){var r,o;t.preventDefault(),I(u,0,"Сохранить..."),(r=v.value,o=y.value,fetch("".concat(e.url,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:"".concat(r),about:"".concat(o)})}).then((function(e){return N(e)}))).then((function(e){M(e),R(n)})).catch((function(e){return console.log(e)})).finally((function(){I(u,0,"Сохранить")}))}(t)})),c.addEventListener("click",(function(){return R(n)})),a.addEventListener("click",(function(){return w(i),void Q(i)})),l.addEventListener("submit",(function(t){return function(t){t.preventDefault();var n,r=i.querySelector(".form__save");I(r,0,"Сохранение..."),(n={name:q.value,link:E.value},fetch("".concat(e.url,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify(n)}).then((function(e){return N(e)}))).then((function(e){z(e),R(i),l.reset()})).catch((function(e){return console.log(e)})).finally((function(){I(r,0,"Создать")}))}(t)})),s.addEventListener("click",(function(){return R(i)})),m.addEventListener("click",(function(){return R(_)})),k.addEventListener("click",(function(){return R(L)})),L.addEventListener("submit",(function(t){t.preventDefault();var n,r=t.target.querySelector(".form__save");I(r,0,"Удаление..."),(n=r,fetch("".concat(e.url,"/cards/").concat(n.id),{method:"DELETE",headers:e.headers}).then((function(e){return N(e)}))).then((function(e){"Пост удалён"===e.message&&(Array.from(j.querySelectorAll(".card__delete")).find((function(e){return e.id==r.id})).closest("li").remove(),R(L))})).catch((function(e){return console.log(e)})).finally((function(){I(r,0,"Да")}))})),C.addEventListener("click",(function(){Q(b),w(b)})),x.addEventListener("submit",(function(t){t.preventDefault();var n,r=t.target.querySelector(".form__save");I(r,0,"Сохранение..."),(n={avatar:T.value},fetch("".concat(e.url,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))).then((function(e){U(e),R(b),x.reset()})).catch((function(e){return console.log(e)})).finally((function(){I(r,0,"Сохранить")}))})),A.addEventListener("click",(function(){return R(b)}))})();