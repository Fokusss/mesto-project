(()=>{"use strict";var e,t={url:"https://mesto.nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"69e1601f-6c3f-4190-af86-3fd180da8137","Content-Type":"application/json"},id:"1c333a798ca5f742474a346e"},n=document.querySelector(".profile__avatar"),r=document.querySelector(".pop-up_el_profile-edit"),o=document.querySelector(".profile__edit"),c=document.querySelector('form[name="profile-edit"]'),u=r.querySelector(".pop-up__close"),i=document.querySelector(".pop-up_el_add-card"),a=document.querySelector(".profile__add"),l=i.querySelector('form[name="card-add"]'),s=i.querySelector(".pop-up__close"),d=document.querySelector("#card-js").content,f=document.querySelector(".photo__grid"),m=document.querySelector(".pop-up_el_image"),_=m.querySelector(".pop-up__close"),p=r.querySelector('input[name="name"]'),v=r.querySelector('input[name="text"]'),y=document.querySelector(".profile__name"),h=document.querySelector(".profile__text"),S=i.querySelector('input[name="mesto-name"]'),q=i.querySelector('input[name="url-image"]'),k=document.querySelector(".pop-up_el_delete"),E=k.querySelector(".pop-up__close"),L=k.querySelector(".form__save"),g=document.querySelector(".profile__avatar-button"),C=document.querySelector(".pop-up_el_avatar-edit"),b=C.querySelector(".pop-up__close"),j=C.querySelector(".pop-up__form"),A=j.querySelector('input[name="avatar-lik"]'),x=document.querySelector(".photo__grid"),P={formSelector:".pop-up__form",inputSelector:".form__input",submitButtonSelector:".form__save",inactiveButtonClass:"form__save_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_active"},T=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))},D=function(e,n){return fetch("".concat(t.url,"/cards/likes/").concat(e.id),{method:n,headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))};function w(e,t,n){if(t.parentElement.querySelector(".card__linke-count").textContent=n.length,0!==n.length){var r=n.find((function(t){return t._id===e.id}));console.log(r),null!=r?t.classList.add("card__like_active"):t.classList.remove("card__like_active")}}function B(e){var n=d.querySelector("li").cloneNode(!0),r=n.querySelector(".card__delete"),o=n.querySelector(".card__like"),c=n.querySelector(".card__image"),u=n.querySelector(".card__linke-count");return n.querySelector(".card__name").textContent=e.name,c.src=e.link,c.alt=e.name,r.setAttribute("id",e._id),o.setAttribute("id",e._id),u.textContent=e.likes.length,function(e,t,n){t._id!=e.id&&n.classList.add("card__delete_inactive")}(t,e.owner,r),w(t,o,e.likes),r.addEventListener("click",(function(e){return function(e){var t=e.target;M(k),function(e){L.setAttribute("id",e.id)}(t)}(e)})),o.addEventListener("click",(function(e){return function(e){var n=e.target;n.classList.contains("card__like_active")?D(n,"DELETE").then((function(e){w(t,n,e.likes)})).catch((function(e){return console.log(e)})):D(n,"PUT").then((function(e){w(t,n,e.likes)})).catch((function(e){return console.log(e)}))}(e)})),c.addEventListener("click",(function(t){return n=e.name,r=e.link,(o=m.querySelector(".pop-up__images")).src=r,o.alt=n,m.querySelector(".pop-up__caption").textContent=n,void M(m);var n,r,o})),n}function N(e){var t=B(e);f.prepend(t)}function O(e){y.textContent=e.name,h.textContent=e.about}function J(e){n.setAttribute("src",e.avatar)}function G(e){"Escape"===e.key&&F(document.querySelector(".pop-up_active"))}function H(e,t,n){e.textContent=n}function z(e){e.target.classList.contains("pop-up")&&F(e.target)}function M(e){e.classList.add("pop-up_active"),document.addEventListener("keydown",G),document.addEventListener("mousedown",z)}function U(e){var t=Array.from(e.querySelectorAll(".form__input")),n=e.querySelector(".form__save");T(t,n,P)}function F(e){e.classList.remove("pop-up_active"),document.removeEventListener("keydown",G),document.removeEventListener("mousedown",z)}e=P,Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent="",t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass)}(e,t,n):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=t.validationMessage,t.classList.add(n.inputErrorClass),r.classList.add(n.errorClass)}(e,t,n)}(e,o,t),T(n,r,t)}))}))}(t,e)})),fetch("".concat(t.url,"/users/me"),{headers:t.headers,method:"GET"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){O(e),J(e)})).catch((function(e){return console.log(e)})),fetch("".concat(t.url,"/cards"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){e.reverse(),e.forEach((function(e){N(e)}))})).catch((function(e){return console.log(e)})),o.addEventListener("click",(function(){return p.value=y.textContent,v.value=h.textContent,M(r),void U(r)})),c.addEventListener("submit",(function(e){return function(e){e.preventDefault();var n,o,c=document.querySelector(".form__save");H(c,0,"Сохранить..."),(n=p.value,o=v.value,fetch("".concat(t.url,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:"".concat(n),about:"".concat(o)})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){O(e)})).catch((function(e){return console.log(e)})).finally((function(){H(c,0,"Сохранить")})),F(r)}(e)})),u.addEventListener("click",(function(){return F(r)})),a.addEventListener("click",(function(){return U(i),void M(i)})),l.addEventListener("submit",(function(e){return function(e){e.preventDefault();var n,r=i.querySelector(".form__save");H(r,0,"Сохранение..."),(n={name:S.value,link:q.value},fetch("".concat(t.url,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify(n)})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){N(e)})).catch((function(e){return console.log(e)})).finally((function(){H(r,0,"Создать")})),l.reset(),F(i)}(e)})),s.addEventListener("click",(function(){return F(i)})),_.addEventListener("click",(function(){return F(m)})),E.addEventListener("click",(function(){return F(k)})),k.addEventListener("submit",(function(e){e.preventDefault();var n,r=e.target.querySelector(".form__save");H(r,0,"Удаление..."),(n=r,fetch("".concat(t.url,"/cards/").concat(n.id),{method:"DELETE",headers:t.headers})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){"Пост удалён"===e.message&&(Array.from(x.querySelectorAll(".card__delete")).find((function(e){return e.id==r.id})).closest("li").remove(),F(k))})).catch((function(e){return console.log(e)})).finally((function(){H(r,0,"Да")}))})),g.addEventListener("click",(function(){M(C),U(C)})),j.addEventListener("submit",(function(e){e.preventDefault();var n,r=e.target.querySelector(".form__save");H(r,0,"Сохранение..."),(n={avatar:A.value},fetch("".concat(t.url,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))).then((function(e){J(e)})).catch((function(e){return console.log(e)})).finally((function(){H(r,0,"Сохранить"),F(C),j.reset()}))})),b.addEventListener("click",(function(){return F(C)}))})();